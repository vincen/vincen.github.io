---
layout: post
title: mysql all in one
categories: DATABASE
tags: mysql
---
# 卸载

mac 上用 dmg 方式安装，没有卸载的工具，需要手动删除如下文件：

```shell
sudo rm /usr/local/mysql
sudo rm -rf /usr/local/mysql*
sudo rm -rf /Library/StartupItems/MySQLCOM
sudo rm -rf /Library/PreferencePanes/MySQL
# 这一项没有找到
vim /etc/hostconfig  (and removed the line MYSQLCOM=-YES-)
rm -rf ~/Library/PreferencePanes/MySQL
sudo rm -rf /Library/Receipts/mysql*
sudo rm -rf /Library/Receipts/MySQL*
# 这一项也没找到
sudo rm -rf /var/db/receipts/com.mysql.*
```

# 优化

[环境参照](http://fuqssi.com/000C/)，本机的mysql，内存占用400多M，只是自己的测试环境，可以修改一下参数，使内存降到100M以内。

| parameter                              | raw value | updated value |
| -------------------------------------- | --------- | ------------- |
| performance_schema_max_table_instances | 12500     | 1000          |
| table_open_cache                       | 2000      | 400           |
| table_definition_cache                 | 1400      | 256           |

# 技巧

## 删除 schema 下所有表

```sql
SET FOREIGN_KEY_CHECKS = 0

SELECT concat('DROP TABLE IF EXISTS ', table_name, ';')
FROM information_schema.tables
WHERE table_schema = 'MyDatabaseName';

SET FOREIGN_KEY_CHECKS = 1
```

# 问题解决

## 本地用 MySQLWorkbench 无法连接MySQL

通过命令行 `mysql -h localhost -u root -p`，可以正常连接 mysql，但是 workbench 连接时提示：

```
Your connection attempt failed for user 'root' from your host to server at localhost:3306:   Host '::1' is not allowed to connect to this MySQL server
```

瞬间懵逼，之后百度10分钟。做了两个设置。workbench 能正常连接 mysql。

step1：

```mysql
mysql>use mysql;
mysql>update user set host = '%' where user = 'root';
```

step2：

```mysql
GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' WITH GRANT OPTION;
```

## 链接 mysql 时，报 ssl 警告


> WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.


解决方法一：不使用ssl，自然就不报错了。

[http://stackoverflow.com/questions/34189756/warning-about-ssl-connection-when-connecting-to-mysql-database](http://stackoverflow.com/questions/34189756/warning-about-ssl-connection-when-connecting-to-mysql-database)

解决方法二：使用ssl链接mysql。

[https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-using-ssl.html](https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-using-ssl.html)

解决方法三：使用ssl链接，但是不验证服务证书。

```java
String url = "jdbc:mysql://127.0.0.1:3306/sample"+
				"?verifyServerCertificate=false"+
				"&useSSL=true"+
				"&requireSSL=true";
```
# 命令备忘

```mysql
# 查看服务器支持的引擎
mysql> SHOW ENGINES;
# 列出支持的所有字符集
mysql> SHOW CHARACTER SET;
# 当前服务器字符集的设置 
mysql> SHOW VARIABLES LIKE 'character_set_%';
# 当前服务器字符序的设置。（用于指定数据集如何排序，以及字符串的比对规则）
mysql> SHOW VARIABLES LIKE 'collation_%';
# 将远程机器上的数据库备份到本地
$ mysqldump --opt -hIP -uUsername -pPassword databaseName>database.sql
参数：--no-data：只导出表结构。
# 导入数据库
mysql> use 数据库
mysql> source d:\wcnc_db.sql
```

# UUID Smackdown: UUID vs. INT for Primary Key

## Introduction to MySQL UUID

UUID stands for Universally Unique IDentifier. UUID is defined based on [RFC 4122](https://tools.ietf.org/html/rfc4122), “a Universally Unique Identifier (UUID) URN Namespace).

UUID is designed as a number that is unique globally in space and time. Two UUID values are expected to be distinct, even they are generated on two independent servers.

In MySQL, a UUID value is a 128-bit number represented as a utf8 string of five hexadecimal numbers in the following format:

```sql
aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
```

To generate UUID values, you use the `UUID()` function.

The `UUID()` function returns a UUID value in compliance with UUID version 1 described in the RFC 4122.

For example, the following statement uses the `UUID()` function to generate a UUID value:

```sql
mysql> SELECT UUID();
+--------------------------------------+
| uuid()                               |
+--------------------------------------+
| 865234ad-6a92-11e7-8846-b05adad3f0ae |
+--------------------------------------+
1 row in set (0.05 sec)
```

## UUID vs. Auto-Increment INT as primary key

### Pros

Using UUID for a [primary key ](https://www.mysqltutorial.org/mysql-uuid/) brings the following advantages:

- UUID values are unique across tables, databases, and even servers that allow you to merge rows from different databases or distribute databases across servers.
- UUID values do not expose the information about your data so they are safer to use in a URL. For example, if a customer with id 10 accesses his account via `http://www.example.com/customers/10/` URL, it is easy to guess that there is a customer 11, 12, etc., and this could be a target for an attack.
- UUID values can be generated anywhere that avoid a round trip to the database server. It also simplifies logic in the application. For example, to insert data into a parent table and child tables, you have to insert into the parent table first, get generated id and then insert data into the child tables. By using UUID, you can generate the primary key value of the parent table up front and insert rows into both parent and child tables at the same time within a transaction.

### Cons

Besides the advantages, UUID values also come with some disadvantages:

- Storing UUID values (16-bytes) takes more storage than integers (4-bytes) or even big integers(8-bytes).
- Debugging seems to be  more difficult, imagine the expression `WHERE id = 'df3b7cb7-6a95-11e7-8846-b05adad3f0ae'` instead of `WHERE id = 10`
- Using UUID values may cause performance issues due to their size and not being ordered.

## MySQL UUID solution

In MySQL, you can store UUID values in a compact format (`BINARY`) and display them in human-readable format ([`VARCHAR`](https://www.mysqltutorial.org/mysql-varchar/)) with help of the following functions:

- `UUID_TO_BIN`
- `BIN_TO_UUID`
- `IS_UUID`

Notice that `UUID_TO_BIN()`, `BIN_TO_UUID()`, and `IS_UUID()` functions are only available in MySQL 8.0 or later.

The `UUID_TO_BIN()` function converts a UUID from a human-readable format (`VARCHAR`) into a compact format (`BINARY`) format for storing and the `BIN_TO_UUID()` function converts UUID from the compact format (`BINARY`)to human-readable format (`VARCHAR`) for displaying.

The `IS_UUID()` function returns 1 if the argument is a valid string-format UUID. If the argument is not valid string format UUID, the `IS_UUID` function returns 0. In case the argument is `NULL`, the `IS_UUID()` function returns `NULL`.

The following are the valid string-format UUID in MySQL:

```sql
aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
aaaaaaaabbbbccccddddeeeeeeeeeeee
{aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee}
```

### MySQL UUID example

Let’s take a look at an example of using UUID as the primary key.

The following statement [creates a new table](https://www.mysqltutorial.org/mysql-create-table/) named `customers`:

```sql
CREATE TABLE customers (
    id BINARY(16) PRIMARY KEY,
    name VARCHAR(255)
);
```

To [insert](https://www.mysqltutorial.org/mysql-insert-statement.aspx) UUID values into the `id` column, you use `UUID()` and `UUID_TO_BIN()` functions as follows:

```sql
INSERT INTO customers(id, name)
VALUES(UUID_TO_BIN(UUID()),'John Doe'),
      (UUID_TO_BIN(UUID()),'Will Smith'),
      (UUID_TO_BIN(UUID()),'Mary Jane');
Code language: SQL (Structured Query Language) (sql)
```

To query data from a UUID column, you use `BIN_TO_UUID()` function to convert binary format to human-readable format:

```sql
SELECT 
    BIN_TO_UUID(id) id, 
    name
FROM
    customers;   
```

