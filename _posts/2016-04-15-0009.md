---
layout: post
title: PostgreSQL all in one
categories: database
tags: postgresql
---
# 比较

1、 [why favor postgresql over mariadb mysql](https://www.cybertec-postgresql.com/en/why-favor-postgresql-over-mariadb-mysql/) （[中文翻译](https://blog.csdn.net/qiansg123/article/details/80131429)）

# 使用

初始化（用 brew 安装，已经初始化好了默认库）

```shell
initdb /usr/local/var/postgres
```

创建用户，这一步必须做，否则会报：`role "postgres" does not exist`

```shell
/usr/local/opt/postgres/bin/createuser -s postgres
```

login/sign out from command line tool

```shell
psql -U root -d postgres -h 127.0.0.1
\q (or ctrl + D)
```

create user, database and grant all privileges

```sql
create user username with password 'password';
create database dbname owner username;
grant all privileges on database dbname to username;
```

export, import database

```shell
pg_dump -h localhost -d projection -U hiway > projection.sql
pg_dump -h localhost -d projection -U hiway < projection.sql
```

listen remote connections

```properties
# update file postgresql.conf
listen_addresses = '*'
```

add connection method

```properties
# add a remote user information in pg_hba.conf
# for example:
host	all		postgres	192.168.1.58/32		trust
```

query postgresql variables

```sql
show shared_buffers;
show all;
```

# 扩展

```sql
-- 查询扩展
\dx
-- 安装扩展
CREATE EXTENSION pgcrypto;
-- 生成 UUID
SELECT gen_random_uuid();
```



# 特殊

在 Pg 中，`::`是指将前面的内容强制转换为`::` 后面所指定的数据类型，以满足一些查询或是函数对数据类型的要求。



# 字符编码

```sql
-- 查看服务端字符编码
show server_encoding;
-- 查看客户端字符编码
show client_encoding;
-- 设置临时客户端字符编码，推出后会还原
set client_encoding to 'SQL_ASCII';
```

# 基础概念

## 提示符

```sql
mydb=>		-- 普通用户提示符
mydb=#		-- 超级用户提示符
```

## 一些常用函数和属性

```sql
SELECT version();		-- 查看数据库版本
SELECT current_date;	-- 查看当前日期
SELECT current_time;	-- 查看当前时间

```

## 一些内部命令

```sql
\q		-- 退出数据库
\?		-- 查询所有内部命令
\h		-- 查询 SQL 命令的帮助语法
```

## 单步模式

```shell
$ psql -s mydb
...
mydb=> \i basics.sql
```

psql 的 -s 选项把你置于单步模式，它在向服务器发送每个语句之前暂停。 \i 命令从指定的文件中读取命令。

# SQL 语言

## COPY

```sql
COPY weather FROM '/home/user/weather.txt';
```

使用`COPY`从文本文件中装载大量数据。这种方式通常更快，因为`COPY`命令就是为这类应用优化的， 只是比 `INSERT`少一些灵活性。

## DISTINCT

在一些数据库系统里，包括老版本的 PostgreSQL，`DISTINCT`的实现自动对行进行排序，因此`ORDER BY`是多余的。但是这一点并不是 SQL 标准的要求，并且目前的 PostgreSQL 并不保证`DISTINCT`会导致行被排序。